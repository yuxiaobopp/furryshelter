(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d081d120","chunk-8a0a96b2","chunk-7a01d532"],{"1af6":function(t,e,a){var n=a("63b6");n(n.S,"Array",{isArray:a("9003")})},"4fac":function(t,e,a){"use strict";var n=a("58c2"),i=a.n(n);i.a},"54cb":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"table-operator"},[a("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(e){return t.hanldleAdd()}}},[t._v("新建")]),a("a-button",{attrs:{type:"primary",icon:"minus",disabled:!t.hasSelected(),loading:t.loading},on:{click:function(e){return t.handleDelete(t.selectedRowKeys)}}},[t._v("删除")]),a("a-button",{attrs:{type:"primary",icon:"redo"},on:{click:function(e){return t.getDataList()}}},[t._v("刷新")])],1),t.data&&t.data.length?a("a-table",{ref:"table",attrs:{columns:t.columns,rowKey:function(t){return t.Id},dataSource:t.data,pagination:!1,loading:t.loading,rowSelection:{selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange},bordered:!0,defaultExpandAllRows:!0,size:"small"},on:{change:t.handleTableChange},scopedSlots:t._u([{key:"action",fn:function(e,n){return a("span",{},[[a("a",{on:{click:function(e){return t.handleEdit(n.Id)}}},[t._v("编辑")]),a("a-divider",{attrs:{type:"vertical"}}),a("a",{on:{click:function(e){return t.handleDelete([n.Id])}}},[t._v("删除")])]],2)}},{key:"icon",fn:function(e,n){return a("span",{},[[n.icon?a("a-icon",{attrs:{type:n.icon}}):t._e()]],2)}},{key:"permissions",fn:function(e,n){return a("span",{},[t._l(n.PermissionValues,function(e,n){return[0!=n?a("br",{key:n}):t._e(),t._v("\n        "+t._s(e)+"\n      ")]})],2)}}],null,!1,851171810)}):t._e(),a("edit-form",{ref:"editForm",attrs:{afterSubmit:t.getDataList}})],1)},i=[],o=a("cebc"),s=a("581c"),r=a("e62b"),c=[{title:"菜单名",dataIndex:"Text",width:"15%"},{title:"类型",dataIndex:"TypeText",width:"5%"},{title:"路径",dataIndex:"Url",width:"25%"},{title:"需要权限",dataIndex:"NeedActionText",width:"10%"},{title:"页面权限",dataIndex:"PermissionValuesText",width:"20%",scopedSlots:{customRender:"permissions"}},{title:"图标",dataIndex:"icon",width:"5%",scopedSlots:{customRender:"icon"}},{title:"排序",dataIndex:"Sort",width:"5%"},{title:"操作",dataIndex:"action",scopedSlots:{customRender:"action"}}],l={components:{EditForm:s["default"],PermissionList:r["default"]},mounted:function(){this.getDataList()},data:function(){return{data:[],pagination:{current:1,pageSize:10,showTotal:function(t,e){return"总数:".concat(t," 当前:").concat(e[0],"-").concat(e[1])}},filters:{},sorter:{field:"Id",order:"asc"},loading:!1,columns:c,visible:!1,selectedRowKeys:[],menuName:""}},methods:{handleTableChange:function(t,e,a){this.pagination=Object(o["a"])({},t),this.filters=Object(o["a"])({},e),this.sorter=Object(o["a"])({},a),this.getDataList()},getDataList:function(){var t=this;this.selectedRowKeys=[],this.loading=!0,this.$http.post("/Base_Manage/Base_Action/GetMenuTreeList",Object(o["a"])({PageIndex:this.pagination.current,PageRows:this.pagination.pageSize,SortField:this.sorter.field||"Id",SortType:"ascend"==this.sorter.order?"asc":"desc"},this.filters)).then(function(e){t.loading=!1,t.data=e.Data;var a=Object(o["a"])({},t.pagination);a.total=e.Total,t.pagination=a})},onSelectChange:function(t){this.selectedRowKeys=t},hasSelected:function(){return this.selectedRowKeys.length>0},hanldleAdd:function(){this.$refs.editForm.openForm()},handleEdit:function(t){this.$refs.editForm.openForm(t)},handleDelete:function(t){var e=this;this.$confirm({title:"确认删除吗?",onOk:function(){return new Promise(function(a,n){e.submitDelete(t,a,n)})}})},submitDelete:function(t,e,a){var n=this;this.$http.post("/Base_Manage/Base_Action/DeleteData",t).then(function(t){e(),t.Success?(n.$message.success("操作成功!"),n.getDataList()):n.$message.error(t.Msg)})},managePermission:function(t){var e=this;this.menuName="【".concat(t.Text,"】页面权限"),this.$nextTick(function(){e.$refs.permissionList.setParentId(t.Id),e.$refs.permissionList.getDataList()})}}},d=l,u=a("2877"),f=Object(u["a"])(d,n,i,!1,null,null,null);e["default"]=f.exports},"581c":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=this,a=e.$createElement,n=e._self._c||a;return n("a-modal",{attrs:{title:"编辑表单",width:"40%",visible:e.visible,confirmLoading:e.confirmLoading},on:{ok:e.handleSubmit,cancel:function(){t.visible=!1}}},[n("a-spin",{attrs:{spinning:e.confirmLoading}},[n("a-form-model",e._b({ref:"form",attrs:{model:e.entity,rules:e.rules}},"a-form-model",e.layout,!1),[n("a-form-model-item",{attrs:{label:"菜单名",prop:"Name"}},[n("a-input",{attrs:{autocomplete:"off"},model:{value:e.entity.Name,callback:function(t){e.$set(e.entity,"Name",t)},expression:"entity.Name"}})],1),n("a-form-model-item",{attrs:{label:"上级菜单",prop:"ParentId"}},[n("a-tree-select",{attrs:{allowClear:"",treeData:e.ParentIdTreeData,placeholder:"请选择上级菜单",treeDefaultExpandAll:""},model:{value:e.entity.ParentId,callback:function(t){e.$set(e.entity,"ParentId",t)},expression:"entity.ParentId"}})],1),n("a-form-model-item",{attrs:{label:"类型",prop:"Type"}},[n("a-radio-group",{model:{value:e.entity.Type,callback:function(t){e.$set(e.entity,"Type",t)},expression:"entity.Type"}},[n("a-radio",{attrs:{value:0}},[e._v("菜单")]),n("a-radio",{attrs:{value:1}},[e._v("页面")])],1)],1),n("a-form-model-item",{attrs:{label:"路径",prop:"Url"}},[n("a-input",{attrs:{autocomplete:"off"},model:{value:e.entity.Url,callback:function(t){e.$set(e.entity,"Url",t)},expression:"entity.Url"}})],1),n("a-form-model-item",{attrs:{label:"是否需要权限",prop:"NeedAction"}},[n("a-radio-group",{model:{value:e.entity.NeedAction,callback:function(t){e.$set(e.entity,"NeedAction",t)},expression:"entity.NeedAction"}},[n("a-radio",{attrs:{value:!1}},[e._v("否")]),n("a-radio",{attrs:{value:!0}},[e._v("是")])],1)],1),n("a-form-model-item",{attrs:{label:"图标",prop:"Icon"}},[n("a-input",{attrs:{autocomplete:"off"},model:{value:e.entity.Icon,callback:function(t){e.$set(e.entity,"Icon",t)},expression:"entity.Icon"}})],1),n("a-form-model-item",{attrs:{label:"排序",prop:"Sort"}},[n("a-input",{attrs:{type:"number",autocomplete:"off"},model:{value:e.entity.Sort,callback:function(t){e.$set(e.entity,"Sort",t)},expression:"entity.Sort"}})],1),n("a-card",{attrs:{title:"页面权限",bordered:!1}},[n("Permission-List",{ref:"permissionList",attrs:{parentObj:this}})],1)],1)],1)],1)},i=[],o=a("e62b"),s={props:{afterSubmit:{type:Function,default:null}},components:{PermissionList:o["default"]},data:function(){return{layout:{labelCol:{span:5},wrapperCol:{span:18}},visible:!1,confirmLoading:!1,entity:{},ParentIdTreeData:[],rules:{Name:[{required:!0,message:"必填"}],Type:[{required:!0,message:"必填"}],NeedAction:[{required:!0,message:"必填"}]}}},methods:{init:function(t){var e=this;this.visible=!0,this.entity={},this.$nextTick(function(){e.$refs.permissionList.init(t),e.$refs["form"].clearValidate()}),this.$http.post("/Base_Manage/Base_Action/GetMenuTreeList",{}).then(function(t){t.Success&&(e.ParentIdTreeData=t.Data)})},openForm:function(t){var e=this;this.init(t),t&&this.$http.post("/Base_Manage/Base_Action/GetTheData",{id:t}).then(function(t){e.entity=t.Data})},handleSubmit:function(){var t=this;this.$refs["form"].validate(function(e){e&&(t.confirmLoading=!0,t.entity.permissionList=t.$refs.permissionList.getPermissionList(),t.$http.post("/Base_Manage/Base_Action/SaveData",t.entity).then(function(e){t.confirmLoading=!1,e.Success?(t.$message.success("操作成功!"),t.afterSubmit(),t.visible=!1):t.$message.error(e.Msg)}))})}}},r=s,c=a("2877"),l=Object(c["a"])(r,n,i,!1,null,null,null);e["default"]=l.exports},"58c2":function(t,e,a){},"75fc":function(t,e,a){"use strict";var n=a("a745"),i=a.n(n);function o(t){if(i()(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}var s=a("774e"),r=a.n(s),c=a("c8bb"),l=a.n(c);function d(t){if(l()(Object(t))||"[object Arguments]"===Object.prototype.toString.call(t))return r()(t)}function u(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function f(t){return o(t)||d(t)||u()}a.d(e,"a",function(){return f})},"774e":function(t,e,a){t.exports=a("d2d5")},a745:function(t,e,a){t.exports=a("f410")},c8bb:function(t,e,a){t.exports=a("54a1")},e62b:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-spin",{attrs:{spinning:t.loading}},[a("div",{staticClass:"table-operator"},[a("a-button",{staticClass:"editable-add-btn",attrs:{icon:"plus",type:"default"},on:{click:t.handleAdd}},[t._v("添加权限")])],1),a("a-table",{attrs:{columns:t.columns,dataSource:t.data,bordered:"",size:"small",pagination:!1},scopedSlots:t._u([t._l(["Name","Value"],function(e){return{key:e,fn:function(n,i){return[a("div",{key:e},[i.editable?a("a-input",{staticStyle:{margin:"-5px 0"},attrs:{value:n},on:{change:function(a){return t.handleChange(a.target.value,i.key,e)}}}):[t._v(t._s(n))]],2)]}}}),{key:"operation",fn:function(e,n){return[a("div",{staticClass:"editable-row-operations"},[n.editable?a("span",[a("a",{on:{click:function(){return t.save(n.key)}}},[t._v("保存")]),a("br"),a("a-popconfirm",{attrs:{title:"确认取消吗?"},on:{confirm:function(){return t.cancel(n.key)}}},[a("a",[t._v("取消")])])],1):a("span",[a("a",{on:{click:function(){return t.edit(n.key)}}},[t._v("编辑")]),t.data.length?a("a-popconfirm",{attrs:{title:"确认删除吗?"},on:{confirm:function(){return t.onDelete(n.key)}}},[a("a",{attrs:{href:"javascript:;"}},[t._v("删除")])]):t._e()],1)])]}}],null,!0)})],1)},i=[],o=(a("ac6a"),a("cebc")),s=a("75fc"),r=a("7ecf"),c=[{title:"权限名",dataIndex:"Name",width:"30%",scopedSlots:{customRender:"Name"}},{title:"权限值(唯一)",dataIndex:"Value",width:"50%",scopedSlots:{customRender:"Value"}},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"}}],l={data:function(){return{data:[],columns:c,loading:!1,parentId:null}},methods:{handleChange:function(t,e,a){var n=Object(s["a"])(this.data),i=n.filter(function(t){return e===t.key})[0];i&&(i[a]=t,this.data=n)},edit:function(t){var e=Object(s["a"])(this.data),a=e.filter(function(e){return t===e.key})[0];a&&(a.editable=!0,this.data=e)},save:function(t){var e=Object(s["a"])(this.data),a=e.filter(function(e){return t===e.key})[0];a&&(delete a.editable,this.data=e,this.resetCache(e))},cancel:function(t){var e=Object(s["a"])(this.data),a=e.filter(function(e){return t===e.key})[0];a&&(Object.assign(a,this.cacheData.filter(function(e){return t===e.key})[0]),delete a.editable,this.data=e)},onDelete:function(t){var e=Object(s["a"])(this.data);this.data=e.filter(function(e){return e.key!==t})},handleAdd:function(){var t={key:r.v4(),Name:"权限名",Value:"权限值",Type:2,ParentId:this.parentId};this.data=[].concat(Object(s["a"])(this.data),[t])},getPermissionList:function(){return this.data},handleSave:function(){var t=this;this.loading=!0,this.$http.post("/Base_Manage/Base_Action/SavePermission",{parentId:this.parentId,permissionListJson:JSON.stringify(this.data)}).then(function(e){t.loading=!1,e.Success?(t.$message.success("权限设置成功"),t.getDataList()):t.$message.error("操作失败")})},resetCache:function(t){this.cacheData=t.map(function(t){return Object(o["a"])({},t)})},getDataList:function(){var t=this;this.loading=!0,this.$http.post("/Base_Manage/Base_Action/GetPermissionList",{parentId:this.parentId}).then(function(e){t.loading=!1,e.Data.forEach(function(t){return t["key"]=r.v4()}),t.data=e.Data,t.resetCache(t.data)})},init:function(t){this.parentId=t,this.data=[],this.parentId&&this.getDataList()}}},d=l,u=(a("4fac"),a("2877")),f=Object(u["a"])(d,n,i,!1,null,"d27cb9a2",null);e["default"]=f.exports},f410:function(t,e,a){a("1af6"),t.exports=a("584a").Array.isArray}}]);